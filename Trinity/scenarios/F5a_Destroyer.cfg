#textdomain wesnoth-Trinity

# this is a story scenario
[scenario]
	id="F5a"
	name= _ "Destroyer"
	map_data="{~add-ons/Trinity/maps/F3a_B.map}"
	next_scenario=F5a2
	victory_when_enemies_defeated=no
	{TURNS 34 29 24}

	[music]
	name="underground.ogg"
	[/music]

	{DEFAULT_SCHEDULE}

[story]
    [part]
        story= _ "Nemesis was not proud of leaving her followers in the clutches of Hera, but did not know what to do about it. She felt drawn back to the ruined earth near Weldyn, there may be answers there..."
        background="story/Trinity_maelstrom.jpg"
    [/part]
[/story]


	[event]
	name=prestart
		[objectives]
		side=0
                       [objective]
                        condition=win
                        description=_ "..."
                        [/objective]
                       [objective]
                        condition=lose
                        description=_ "Death of "
                        [/objective]
		[/objectives]
        [object]
                silent=yes
                duration=forever
                    [filter]
                        id=Seth
                    [/filter]
		[effect]
                        apply_to=image_mod
                        replace="GS()"
                [/effect]
        [/object]
        [object]
                silent=yes
                duration=forever
                    [filter]
                        id=Echidna
                    [/filter]
		[effect]
                        apply_to=image_mod
                        replace="GS()~O(0.5)"
                [/effect]
        [/object]
	[store_unit]
	    [filter]
		id=Seth
	    [/filter]
		variable=seth
		kill=yes
	[/store_unit]
	[store_unit]
	    [filter]
		id=Echidna
	    [/filter]
		variable=echidna
		kill=yes
	[/store_unit]
	[set_variable]
	    name=seth.x
	    value=14
	[/set_variable]
	[set_variable]
	    name=seth.y
	    value=6
	[/set_variable]
	[set_variable]
	    name=seth.facing
	    value=sw
	[/set_variable]
	[set_variable]
	    name=echidna.facing
	    value=ne
	[/set_variable]
	[set_variable]
	    name=echidna.x
	    value=7
	[/set_variable]
	[set_variable]
	    name=echidna.y
	    value=6
	[/set_variable]
        [item]
        halo=misc/maelstrom-1.png~O(0.5):300,misc/maelstrom-1b.png~O(0.5):300,misc/maelstrom-2.png~O(0.5):300,misc/maelstrom-2b.png~O(0.5):300,misc/maelstrom-3.png~O(0.5):300,misc/maelstrom-3b.png~O(0.5):300,misc/maelstrom-4.png~O(0.5):300,misc/maelstrom-4b.png~O(0.5):300,misc/maelstrom-5.png~O(0.5):300,misc/maelstrom-5b.png~O(0.5):300,misc/maelstrom-6.png~O(0.5):300,misc/maelstrom-6b.png~O(0.5):300misc/maelstrom-7.png~O(0.5):300,misc/maelstrom-7b.png~O(0.5):300,misc/maelstrom-8.png~O(0.5):300,misc/maelstrom-8b.png~O(0.5):300
        x,y=17,9
        [/item]
	[/event]

	{STARTING_VILLAGES_AREA 1 4 43 2}
	{STARTING_VILLAGES_AREA 1 16 44 2}
	{STARTING_VILLAGES_AREA 3 29 44 2}
	{STARTING_VILLAGES_AREA 3 39 43 2}

        [side]
        type=Seth
        id=Seth
	name= "Seth"
        side=1
        canrecruit=yes
        controller=human
                [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
                [/modifications]
        profile="portraits/seth.png~GS()~O(0.5)"
        fog=no
        recruit=
	share_view=yes
        team_name=Phantom
	    [unit]
	    type=Trinity Destroyer
	    name=Nemesis
	    id=Nemesis_
	    x,y=recall,recall
	    [/unit]
        [/side]

        [side]
        type=Echidna
        id=Echidna
        name= _ "Echidna"
        ellipse="misc/ellipse"
                [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
                [/modifications]
        profile="portraits/echidna.png~GS()~O(0.5)"
        unrenamable=yes
        side=2
        canrecruit=yes
        controller=ai
	facing=nw
        fog=no
        recruit=
        team_name=Phantom
        [/side]

        [side]
        type=Primeval Nemesishi
        id=Nemesis
        name= _ "Nemesis"
        side=3
	facing=nw
        canrecruit=yes
        controller=human
        fog=no
        shroud=no
        recruit=
	share_view=yes
        team_name=Primeval
        [/side]

	[event]
	[music]
	name="nunc_dimittis.ogg"
	append=no
	immediate=yes
	[/music]
	name=start
	    [message]
		speaker=Nemesis
		message= _ "This place has remained static..."
	    [/message]
	    {MOVE_UNIT (id=Nemesis) 9 23}
	    [message]
		speaker=Nemesis
		message= _ "I cannot explain it, but there must be something to that swirl..."
	    [/message]
	    {MOVE_UNIT (id=Nemesis) 12 8}
	[unstore_unit]
	    variable=echidna
	[/unstore_unit]
	    [message]
		speaker=Echidna
		message= _ "I knew you'd come back, my dear Nemesis..."
	    [/message]
	    {MODIFY_UNIT (id=Nemesis) facing sw}
	    [message]
		speaker=Nemesis
		message= _ "You... I should kill you, but you are dead... Is this the great evil?"
	    [/message]
	    {MOVE_UNIT (id=Echidna) 7 8}
	    [message]
		speaker=Echidna
		message= _ "'Evil' is such a harsh word..."
	    [/message]
	    {MOVE_UNIT (id=Echidna) 9 8}
	    [message]
		speaker=Echidna
		message= _ "Some would say you are 'evil'."
	    [/message]
	[unstore_unit]
	    variable=seth
	[/unstore_unit]
	    [message]
		speaker=Seth
		message= _ "It is a matter of perspective. We would not say you are evil, Nemesis."
	    [/message]
	    {MODIFY_UNIT (id=Nemesis) facing ne}
	    [message]
		speaker=Nemesis
		message= _ "Who are you?"
	    [/message]
	    {MOVE_UNIT (id=Seth) 13 7}
	    [message]
		speaker=Seth
		message= _ "Forgive me, I am Seth. You are looking unsteady on your feet, so I'll keep it brief:"
	    [/message]
	    [message]
		speaker=Seth
		message= _ "Echidna and I are not what we once were, it seems, and lack the strength to realize our true form. You are strong, and can help push us over the edge."
	    [/message]
	    [message]
		speaker=Nemesis
		message= _ "Why... would I want to do that?"
	    [/message]
	    [message]
		speaker=Seth
		message= _ "You will gain unimaginable power, you will be the strong arm of the new existence. Join us and we will form an omnipresent Trinity."
	    [/message]
	    [message]
		speaker=Nemesis
		message= _ "No... I don't like this. I'm leaving!"
	    [/message]
	    {MOVE_UNIT (id=Nemesis) 12 10}
	[music]
	name="gathering_storm.ogg"
	append=no
	immediate=yes
	[/music]	
	    [message]
		speaker=Seth
		message= _ "You do not have that choice."
	    [/message]
	    {MOVE_UNIT (id=Seth) 12 9}
	    {MODIFY_UNIT (id=Nemesis) facing sw}
	    [message]
		speaker=Echidna
		message= _ "Let bygones be bygones, my former Nemesis..."
	    [/message]
	    {MOVE_UNIT (id=Echidna) 11 10}
	    [message]
		speaker=narrator
		message= _ "For the first time in her life, Nemesis was truely scared..."
	        image=wesnoth-icon.png
	    [/message]
#	    {FADE_TO_BLACK}
	    {FLASH_WHITE (
	    [kill]
		id=Echidna
	    [/kill]
	    [kill]
		id=Seth
	    [/kill]
	    [kill]
		id=Nemesis
	    [/kill]
#	    {TRANSFORM_UNIT (id=Nemesis) "Trinity Destroyer"}	
	    [recall]
	       id=Nemesis_
	       x,y=12,10
		show=yes
	    [/recall]
	    )}
#	    [animate_unit]
#	    	flag=levelout
#		[filter]
#		id=Nemesis_
#		[/filter]			
#	    [/animate_unit]
	    [redraw][/redraw]
#	    {FADE_IN}
	    
	    [message]
		speaker=Nemesis_
		message= _ "<i>Snarl!</i>"
	    [/message]
	    {MOVE_UNIT (id=Nemesis_) 12 44}
	    [kill]
		id=Nemesis_
	    [/kill]
	    [redraw][/redraw]
	    [endlevel]
		{CONTINUE}
	    [/endlevel]
	[/event]
[/scenario]

[scenario]
	id="F5a2"
	name= _ "Finale"
	map_data="{~add-ons/Trinity/maps/F5a.map}"
	next_scenario=Epilogue
	victory_when_enemies_defeated=no
	{TURNS 75 65 55}

	[music]
	name="underground.ogg"
	[/music]

	{BMR_STORE_SIDE 1}
	{BMR_RESTORE_SIDE 1}
	{BMR_STORE_SIDE 3}
	{BMR_RESTORE_SIDE 3}
	{DAWN}

[story]
#    [part]
#        story= _ "This scenario is playable, but it is a work in progress."
#        background="misc/Trinity_warning.jpg"
#    [/part]
    [part]
        story= _ "The forces of the Primeval goddess rounded up the demoralized humans and locked them in cave-like dungeons. The humans noticed that Dardrus was not locked in with them. They wondered if he had also abandoned them, and was negotiating a special deal to save his own skin."
        background="story/Trinity_cave.jpg"
    [/part]
    [part]
        story= _ "They needn't have worried about that..."
#        background="story/Trinity_cave.jpg"
    [/part]
[/story]


	[event]
	name=prestart
		[objectives]
		side=0
                       [objective]
                        condition=win
                        description=_ "Escape the Airship"
                        [/objective]
                       [objective]
                        condition=lose
                        description=_ "Death of Haldrad"
                        [/objective]
                       [objective]
                        condition=lose
                        description=_ "Death of Dardrus"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Bresda"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Tanyche"
                        [/objective]
			note= _ "Tanyche can open locked gates."
		[/objectives]
	[recall]
	id=Dardrus
	x,y=39,17
	[/recall]
	[set_variable]
	    name=tunnel
	    value=0
	[/set_variable]
	[store_unit]
	    [filter]
		id=Bresda
	    [/filter]
		kill=yes
		variable=bresda
		animate=no
	[/store_unit]
	[remove_shroud]
	    side=1,3
	    x,y=35-43,13-19
	[/remove_shroud]
	[remove_shroud]
	    side=1,3
	    x,y=1-18,1-10
	[/remove_shroud]
	[remove_shroud]
	    side=1,3
	    x,y=3-6,17-20
	[/remove_shroud]
	[set_variable]
	name=headcount
	value=0
	[/set_variable]

# the entrance guards
	{GENERIC_UNIT 2 "Primeval Dogface" 9 2}
	[+unit]
	facing=nw
	[/unit]
	{GENERIC_UNIT 2 "Primeval Striker" 8 4}
	[+unit]
	facing=nw
	[/unit]
	[unit]
	type=Primeval Swiftfoot
	profile=portraits/tanyche.png
	id=Key Guard
	name="Tanyche"
	random_traits=yes
	side=2
	x,y=10,5
	facing=nw
	[/unit]

# prison guards
	{GENERIC_UNIT 2 "Primeval Slow" 41 41}
	{GUARDIAN}
	{GENERIC_UNIT 2 "Primeval Slasher" 23 37}
	{GENERIC_UNIT 2 "Primeval Dogface" 24 43}
	{GENERIC_UNIT 2 "Primeval Dogface" 5 18}
	[+unit]
	profile=portraits/dogface2.png
	[/unit]
# throne guards
	{GENERIC_UNIT 2 "Primeval Warrior" 37 14}
	{GENERIC_UNIT 2 "Primeval Slasher" 41 14}
	{GENERIC_UNIT 2 "Primeval Striker" 36 17}

# gates
	#define TRINITY_GATE_SE X Y
	[item]
	x,y={X},{Y}
	image=scenery/gate-rusty-se.png
	[/item]	
	#enddef
	#define TRINITY_GATE_SW X Y
	[item]
	x,y={X},{Y}
	image=scenery/gate-rusty-sw.png
	[/item]	
	#enddef

	{TRINITY_GATE_SE 10 23}
	{TRINITY_GATE_SE 14 44}
	{TRINITY_GATE_SE 23 12}
	{TRINITY_GATE_SE 24 45}
	{TRINITY_GATE_SE 30 39}
	{TRINITY_GATE_SE 34 12}
	{TRINITY_GATE_SE 43 42}
	{TRINITY_GATE_SE 65 33}
	{TRINITY_GATE_SE 66 32}

	{TRINITY_GATE_SW 6 16}
	{TRINITY_GATE_SW 6 42}
	{TRINITY_GATE_SW 10 40}
	{TRINITY_GATE_SW 34 38}
	{TRINITY_GATE_SW 44 36}
	{TRINITY_GATE_SW 48 10}
	{TRINITY_GATE_SW 50 3}
	{TRINITY_GATE_SW 37 45}
	{TRINITY_GATE_SW 38 27}
	
	#undef TRINITY_GATE_SE
	#undef TRINITY_GATE_SW

	[item]
	x,y=61,21
	image=items/sceptre-of-fire.png
	[/item]

	[item]
	x,y=64,38
	halo=scenery/circle-magic.png
	[/item]

	[item]
	image=scenery/rune4.png
	x,y=59,43
	[/item]
	[item]
	image=scenery/rune4.png
	x,y=67,39
	[/item]

	[/event]

#	This is Hera's turf.
	{STARTING_VILLAGES_ALL 2}

	#define HIGH_PRIORITY_TARGETS
	    [target]
	        id=Haldrad
	        value=100
	    [/target]
	    [target]	
	        id=Dardrus
	        value=100
	    [/target]
	    [target]	
	        id=Bresda
	        value=100
	    [/target]
	#enddef

        [side]
        type=Haldrad Fighter
        save_id=Royal
        id=Haldrad
        side=1
        canrecruit=yes
        controller=human
        fog=no
	shroud=yes
        recruit=Spearman, Bowman, Horseman
        {GOLD 250 225 200}
        {INCOME 6 4 2}
	share_view=yes
        team_name=Human
        [/side]

        [side]
        type=Primeval Hera
        id=Hera
        name= _ "Hera"
        ellipse="misc/ellipse"
                [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
                [/modifications]
        profile="portraits/hera.png"
        unrenamable=yes
        side=2
        canrecruit=yes
        controller=ai
	facing=nw
        fog=no
        recruit=Primeval Slow, Primeval Swift, Primeval Cutter
        {GOLD 150 225 300}
        {INCOME 6 9 12}
        team_name=Primeval
# Just so I can abuse the recall list for animation, she's not really on this side
# though I think this is affecting the facing - side 2 is OK, side 5 is not
	    [unit]
		type=Trinity Destroyer
		x,y=recall,recall
		id=Nemesis
		name="Nemesis"
	    [/unit]
        [/side]

        [side]
        type=Primevalist Heroine
        id=Bresda
        name= _ "Bresda Varden"
        side=3
        canrecruit=yes
        controller=human
        fog=no
        shroud=yes
        recruit="SouthSeas Shoreman, SouthSeas Seaman, SouthSeas Caster, SouthSeas Swimmer, SouthSeas Arsonist, Primevalist Fighter, Primevalist Follower"
        {GOLD 250 200 180}
        {INCOME 8 6 4}
	share_view=yes
        team_name=Human
        [/side]

        [side]
        side=4
	no_leader=yes
        controller=ai
        fog=no
        shroud=no
        team_name=Destroyer
        [/side]

        [side]
        side=5
        type=Primeval Driver
        id=Kordun
        name= _ "Kordun"
        ellipse="misc/ellipse"
                [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
                [/modifications]
        recruit=Primeval Slow, Primeval Swiftfoot, Primeval Cutter
        canrecruit=yes
        {GOLD 150 225 300}
        {INCOME 3 6 9}
        team_name=Primeval
        controller=ai
        fog=no
        shroud=no
	[ai]
	recruitment_pattern=archer,archer,scout,fighter
	    [leader_goal]
		x,y=5,34
	    [/leader_goal]
	[/ai]
        [/side]


	#undef HIGH_PRIORITY_TARGETS
# #ifdef ___UNUSED___
	[event]
	name=new turn
	first_time_only=no
	[set_variable]
	    name=tunnel
	    add=-1
	[/set_variable]
	[if]
	    [variable]
		name=tunnel
		greater_than=100
	    [/variable]
	    [then]
		{GENERIC_UNIT 4 "Tomb Wing" 53 2}
		{GENERIC_UNIT 4 "Tomb Archer" 53 5}
		{GENERIC_UNIT 2 "Primeval Dogface" 35 22}
		{GENERIC_UNIT 2 "Primeval Slasher" 38 21}		
	    [/then]
	[/if]
	[/event]

#define TRINITY_RECALL_OR_CREATE TYPE1 TYPE2 X Y SIDE
    [recall]
        type={TYPE1}
	x,y={X},{Y}
    [/recall]
    [if]
        [have_unit]
	    x,y={X},{Y}
        [/have_unit]
        [else]
            [unit]
                type={TYPE2}
                side={SIDE}
                x={X}
                y={Y}
		random_traits=yes
		generate_name=yes
            [/unit]
        [/else]
    [/if]
#enddef

	[event]
	name=start
	    [message]
		speaker=Hera
		message= _ "Your no-good ringleader isn't here, so I will have to use you as the example!"
	    [/message]
	    {MOVE_UNIT (id=Hera) 39 16}	    
	    {FLASH_RED ( 
		[sound]
		name=sword-1.ogg
		[/sound]
		)}
	    [message]
		speaker=Dardrus
		message= _ "Rrrr..."
	    [/message]
	    [message]
		speaker=Hera
		message= _ "If you beg for forgiveness, this pain will be over... Tell me what damage you have done -"
	    [/message]
	[music]
	name="gathering_storm.ogg"
	append=no
	immediate=yes
	[/music]
	    {QUAKE "rumble.ogg"}
	    {MOVE_UNIT (id=Hera) 39 14}	    
	    [message]
		speaker=Hera
		message= "Arxa!?  Geden akka!  Geden a parkua!"
	    [/message]
# blah blah blah
#	    [message]
#		x,y=9,2
#		message= "Kella!  Tehn trana?"  
#	    [/message]
	{THUNDER (
		[scroll_to]
		x,y=7,3
		[/scroll_to]
		[recall]
		id=Nemesis
		x,y=6,2
		show=yes
		[/recall]
#	    [unit]
#		type=Trinity Destroyer
#		side=4
#		x,y=6,2
#		id=Nemesis
#		name="Nemesis"
#	    [/unit]
	)}
	{MODIFY_UNIT (id=Nemesis) side 4}
	    [message]
		speaker=Nemesis
		message=_ "<b><i>Snarl!</i></b>"
	    [/message]
	    [message]
		x,y=8,4
		message=  "Seh! Korunte on treda."
	    [/message]
	{MOVE_UNIT (x,y=9,2) 8 2}
	{MODIFY_UNIT (x,y=8,2) facing se}
	    [message]
		x,y=8,2
		message= "Abranta porcua! Kell a Hera!"
	    [/message]
	{MODIFY_UNIT (x,y=8,2) facing nw}
	    [message]
		speaker=Key Guard
		message= "Ta he!"
	    [/message]
	    {MOVE_UNIT (id=Key Guard) 39 21}
	    [message]
		speaker=Key Guard
		message=_ "Hera! Noxea a porcua! Arun drenda a Nemesis, buera no lokeo."
	    [/message]
	    [message]
		speaker=Hera
		message=_ "Ashah? Geha ante."
	    [/message]
	    [message]
		speaker=Hera
		message= _ "It seems your ring-leader is back. I should keep you alive until she reaches the throne-room, she should see your grovelling."
	    [/message]
#	[unit]
#	type=Primeval Slasher
#	id=Prison Guard2
#	side=2
#	x,y=43,17
#	[/unit]
#	{MOVE_UNIT (id=Prison Guard2) 39 16}


	[move_unit_fake]
		type=Primeval Slasher
		side=2
		x=43,39
		y=17,16
	[/move_unit_fake]	
	    [store_unit]
		[filter]
		id=Dardrus
		[/filter]
		variable=dardrus
		kill=yes
	    [/store_unit]
# This still looks goofy, maybe some day it won't
	[move_units_fake]
		[fake_unit]
		type=Primeval Slasher
		side=2
		x=39,45
		y=16,22
		[/fake_unit]		
		[fake_unit]
		type=$dardrus.type
		side=1
		x=39,46
		y=17,22
		[/fake_unit]		
	[/move_units_fake]
	
	    [set_variable]
		name=dardrus.x
		value=40
	    [/set_variable]
	    [set_variable]
		name=dardrus.y
		value=26
	    [/set_variable]
	    [set_variable]
		name=dardrus.hitpoints
		value=12
	    [/set_variable]
	    [message]
		speaker=Hera
		message=_ "Ghan tradte a hara"
	    [/message]
	    [message]
		speaker=Key Guard
		message= _ "Axia kye, Hera!"
	    [/message]
	    {MOVE_UNIT (id=Key Guard) 4 19}
	    [message]
		speaker=Key Guard
		message= _ "Rauke oussa!"
	    [/message]
	    [message]
		x,y=5,18
		message= _ "Geha, so..."
	    [/message]
	    {MOVE_UNIT (id=Key Guard) 43 37}
	    [message]
		speaker=Key Guard
		message= _ "You! ... Dardrus ... come!"
	    [/message]
	    [message]
		speaker=narrator
		message= _ "The enemy guard opened the cell door and beckoned Haldrad through. Haldrad figured his time had come, but the surprised response of the guard down the tunnel gave him some hope..."
	        image=wesnoth-icon.png
	    [/message]
	    [message]
		x,y=41,41
		message= _ "Nax! Prokya ne?!"
	    [/message]
	    [message]
		speaker=Key Guard
		message= _ "We... move..."
	    [/message]
	    {MODIFY_UNIT (id=Key Guard) side 1}	
	    [remove_item]
		x,y=44,36
	    [/remove_item]
	    [message]
		speaker=Haldrad
		message= _ "I thank you, but I cannot leave my men behind. Can you free them too?"
	    [/message]
	    [message]
		speaker=Key Guard
		message= _ "... (?)"
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "Right, you don't really speak the language of my land... Maybe..."
	    [/message]
	    [message]
		speaker=narrator
		message= _ "Haldrad pointed to his new friend's key ring, then jabbed his finger emphatically at the two visible cell doors. The guard's gaze followed his gesticulations with slight disapproval, then grinned reassuringly and fingered the key-ring."
	        image=wesnoth-icon.png
	    [/message]
	    [message]
		speaker=Key Guard
		message= _ "Come."
	    [/message]
	[music]
	name="legends_of_the_north.ogg"
	append=no
	immediate=yes
	[/music]
	[place_shroud]
	    side=1,3
	    x,y=33-46,11-24
	[/place_shroud]
	[place_shroud]
	    side=1,3
	    x,y=1-18,1-10
	[/place_shroud]
	[place_shroud]
	    side=1,3
	    x,y=3-6,17-20
	[/place_shroud]
	[store_unit]
	    [filter]
		id=Nemesis
	    [/filter]
		variable=nemesis
		kill=yes
	[/store_unit]
	[store_unit]
	    [filter]
		id=Hera
	    [/filter]
		variable=hera
		kill=yes
	[/store_unit]
	[/event]

	[event]
	name=moveto
	    [filter]
		side=1,3
		x=1-9,22-30
	    [/filter]
	[message]
	speaker=Bresda
	message= _ "Stop! Before we go any further, we need to think about what we are doing."
	[/message]
	[message]
	speaker=Haldrad
	message= _ "What? We are escaping prison!"
	[/message]
	[message]
	speaker=Bresda
	message= _ "Yes, well, we are trying to escape a god! We are up in the air, there is no escape! Have you thought of that?"
	[/message]
	[message]
	speaker=Haldrad
	message= _ "Uhm, well, our new friend mentioned Dardrus by name, maybe he is a god too. Would you have us sit in our cells before our executions?"
	[/message]
	[message]
	speaker=Bresda
	message= _ "No, you are right... Nemesis will come to save us, but she will only help us if we try to help ourselves. We will go on now..."
	[/message]
	[/event]

# Cell door openning with Key Guard
	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x,y=42-43,41
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	    [unstore_unit]
		variable=bresda
	    [/unstore_unit]
	    {CLEAR_VARIABLE bresda}
	    {TRINITY_RECALL_OR_CREATE "SouthSeas SkyCaller" "SouthSeas Zephyrist" 47 42 3}
	    [remove_item]
		x,y=43,42
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=43,42
	    [/terrain]
	    [redraw][/redraw]
	    [message]
		speaker=Haldrad
		message= _ "Come with us, Bresda! We're going to get out of here."
	    [/message]
	    [message]
		speaker=Bresda
		message= _ "I never thought I'd be so glad to see you again..."
	    [/message]
	[/event]

#ifdef __UNUSED__
	[event]
	name=recall
	first_time_only=no
	    [filter]
		side=1
		race=undead
		[not]
		id=Sadre
		[/not]
	    [/filter]
		[if]
		    [have_unit]
			id=Sadre
		    [/have_unit]
			[else]
			{MODIFY_UNIT (x,y=$x1,$y1) side 5}
			[message]
			speaker=unit
			message = _ "Our world ...  Needs more souls..."
			[/message]
			[message]
			speaker=Haldrad
			message = _ "The spirits have gone insane?"
			[/message]
			[/else]
		[/if]
	[/event]

	[event]
	name=recall
	    [filter]
		id=Sadre
	    [/filter]
			[message]
			speaker=unit
			message = _ "Bad things ... Our world is almost ... lost ...  We must ... resolve ..."
			[/message]
			[message]
			speaker=Haldrad
			message = _ "We will try, but it will be a challenge just getting off this ship."
			[/message]
	[/event]
#endif

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x,y=37,44
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "SouthSeas Wrecker" "SouthSeas Salvager" 39 47 3}
	{TRINITY_RECALL_OR_CREATE "Royal Guard" "Swordsman" 35 47 1}
	    [remove_item]
		x,y=37,45
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=37,45
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x,y=33-34,39
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "SouthSeas DeckMaster" "SouthSeas AbleSeaman" 34 35 3}
	{TRINITY_RECALL_OR_CREATE "Paladin" "Knight" 36 35 1}
	    [remove_item]
		x,y=34,38
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=34,38
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x,y=31,40
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "SouthSeas Spitfire" "SouthSeas Demolitionist" 29 38 3}
	    [remove_item]
		x,y=30,39
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=30,39
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x,y=24,44
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "SouthSeas Seascourge" "SouthSeas Seahag" 25 47 3}
	{TRINITY_RECALL_OR_CREATE "Pikeman" "Spearman" 22 47 1}
	{TRINITY_RECALL_OR_CREATE "Swordsman" "Spearman" 24 48 1}
	    [remove_item]
		x,y=24,45
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=24,45
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=13,14
		y=44,43
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "SouthSeas Wrecker" "SouthSeas Salvager" 14 46 3}
	{TRINITY_RECALL_OR_CREATE "Halderdier" "Pikeman" 12 46 1}
	    [remove_item]
		x,y=14,44
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=14,44
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=9-10
		y=41
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "Halderdier" "Pikeman" 12 39 1}
	    [remove_item]
		x,y=10,40
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=10,40
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=6,7
		y=41,42
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "SouthSeas Salvager" "SouthSeas Shoreman" 4 44 3}
	{TRINITY_RECALL_OR_CREATE "SouthSeas Seawolf" "SouthSeas Rover" 4 43 3}
	{TRINITY_RECALL_OR_CREATE "Longbowman" "Bowman" 5 46 1}
	{TRINITY_RECALL_OR_CREATE "Longbowman" "Bowman" 3 47 1}
	{GENERIC_UNIT 5 "Primeval Dogface" 6 33}
	{GENERIC_UNIT 5 "Primeval Slasher" 7 33}
	{GENERIC_UNIT 5 "Primeval Ironwheel" 5 32}
	    [remove_item]
		x,y=6,42
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=6,42
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=5-6
		y=17
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	{TRINITY_RECALL_OR_CREATE "Primevalist Prior" "Primevalist Monk" 5 13 3}
	{TRINITY_RECALL_OR_CREATE "Longbowman" "Bowman" 7 13 1}
	    [remove_item]
		x,y=6,16
	    [/remove_item]
	    [terrain]
		terrain=Uu
		x,y=6,16
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=9
		y=23
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto! Agora..."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "I guess we are free of the dungeon- wait!"
	    [/message]
	[music]
	name="legends_of_the_north.ogg"
	append=no
	immediate=no
	[/music]
	    [remove_item]
		x,y=10,23
	    [/remove_item]
	    [terrain]
		terrain=Re
		x,y=10,23
	    [/terrain]
# shroud is not updated in a useful way?
	    [remove_shroud]
                side=1,3
                x=11-16
                y=20-28
            [/remove_shroud]
	    [redraw][/redraw]

	    [move_unit_fake]
		type=Primeval Striker
		x=15,12,12,15
		y=29,25,24,21
		side=2
	    [/move_unit_fake]
	    [move_unit_fake]
		type=Primeval Swiftfoot
		x=15,12,12,15
		y=30,26,25,22
		side=2
	    [/move_unit_fake]
	    [message]
		speaker=Bresda
		message= _ "Where are they off to in such a hurry?"
	    [/message]
	    [sound]
		name=explosion.ogg
	    [/sound]
	    [sound]
		name=lich-die.ogg
	    [/sound]
	    [delay]
		time=500
	    [/delay]
	    [move_unit_fake]
		type=Primeval Swiftfoot
		x=16,13,12,15
		y=20,24,27,29
		side=2
	    [/move_unit_fake]
	    [message]
		speaker=Haldrad
		message= _ "It seems there is some trouble to the left."
	    [/message]
	    [message]
		speaker=Bresda
		message= _ "Trouble for them. What if it's Nemesis come to rescue us?"
	    [/message]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=34,35
		y=13,13
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	    [unit]
		side=1
		type=Battle Queen_
		id=Caldera
		name= _ "Caldera"
		x,y=31,11
		{IS_HERO}
                [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
                [/modifications]
	    [/unit]
# add 2 for Caldera, 1 for Dardrus, so 2-> Caldera only, 1-> Dardrus only, 3-> everybody
	    [set_variable]
	    name=headcount
	    add=2
	    [/set_variable]
	    [message]
		speaker=Haldrad
		message= _ "Mother! You are alive!"
	    [/message]
	    [message]
		speaker=Caldera
		message= _ "Yes, Hera found my 'pretenses at regality' amusing and kept me as a pet."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "Well, now we have a chance to escape, come with us!"
	    [/message]
	    [remove_item]
		x,y=34,12
	    [/remove_item]
	    [terrain]
		terrain=Re
		x,y=34,12
	    [/terrain]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=37
		y=28
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto! Dardrus..."
	    [/message]
	    [unstore_unit]
		variable=dardrus
	    [/unstore_unit]
	    [set_variable]
	    name=headcount
	    add=1
	    [/set_variable]
	    [message]
		speaker=Dardrus
		message= "$unit.name... Grate, dyera."
	    [/message]
	    [message]
		speaker=Key Guard
		message= _ "Dyera chi."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "Dardrus, you are not looking so healthy. What happened?"
	    [/message]
	    [message]
		speaker=Dardrus
		message= _ "Hera was very angry with Nemesis... But Nemesis had escaped, so Hera had to settle for the next-best-thing..."
	    [/message]
	    [remove_item]
		x,y=38,27
	    [/remove_item]
	    [terrain]
		terrain=Re
		x,y=38,27
	    [/terrain]
	[/event]

	[event]
	name=moveto
	first_time_only=no
	    [filter]
		id=Key Guard
		x=47-48
		y=11
	    [/filter]
	    [switch]
		variable=headcount
		[case]
		value=0
		    [message]
			speaker=Key Guard
			message= _ "Velto- edras?"
		    [/message]
		    [message]
			speaker=Haldrad
			message= _ "What does that mean? She won't open the gate..."
		    [/message]
		    [message]
			speaker=Haldrad
			message= _ "We haven't explored these chambers, maybe that has something to do with it."
		    [/message]
		[/case]
		[case]
		value=1
		    [message]
			speaker=Key Guard
			message= _ "Velto- edras?"
		    [/message]
		    [message]
			speaker=Haldrad
			message= _ "What does that mean? She won't open the gate..."
		    [/message]
		    [message]
			speaker=Dardrus
			message= _ "It means she thinks we are leaving someone behind. And that would be dishonourable."
		    [/message]
		[/case]
		[case]
		value=2
		    [message]
			speaker=Key Guard
			message= _ "Velto- edras?"
		    [/message]
		    [message]
			speaker=Haldrad
			message= _ "What does that mean? She won't open the gate..."
		    [/message]
		    [message]
			speaker=Caldera
			message= _ "Do we even know why she is helping us? Maybe there is an answer in some corner we haven't explored."
		    [/message]
		[/case]
		[case]
		value=3
		    [message]
			speaker=Key Guard
			message= _ "Velto!"
		    [/message]
		    [message]
			speaker=Haldrad
			message= _ "That tunnel should lead away from Hera, but who knows where it leads..."
		    [/message]
		    [message]
			speaker=Caldera
			message= _ "I think I know. I saw that tunnel after I escaped from the holding pen your <i>friend</i> there put us in..."
		    [/message]
		    [message]
			speaker=Bresda
			message= _ "Stop glaring at me!"
		    [/message]
		    [message]
			speaker=Caldera
			message= _ "... It was a dead end."
		    [/message]
# this could be adjusted for difficulty, but I'm not sure how yet
		    [set_variable]
			name=tunnel
			value=10
		    [/set_variable]
		    [remove_item]
			x,y=48,10
		    [/remove_item]
		    [terrain]
			terrain=Re
			x,y=48,10
		    [/terrain]
		[/case]
		[else]
		[/else]
	    [/switch]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Key Guard
		x=64,65,66
		y=32,32,31
	    [/filter]			
	    [message]
		speaker=Key Guard
		message= _ "Velto!"
	    [/message]
	    [message]
		speaker=Caldera
		message= _ "I recognize this! This is the prison where we were held. There were some symbols on the floor, the chamber must have had some purpose other than imprisonment. But I know not what that would be."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "We need a way off this mountain, so let us hope it has something to do with transport to the ground."
	    [/message]
	    [message]
		speaker=Bresda
		message= _ "Heck of a leader you are..."
	    [/message]
	    [message]
		speaker=Caldera
		message= _ "You be quiet!"
	    [/message]
# this could be adjusted for difficulty
		{GENERIC_UNIT 2 "Primeval Chariot" 27 27}
		{GENERIC_UNIT 2 "Primeval Chariot" 28 27}
#		{GENERIC_UNIT 2 "Primeval Chariot" 66 48}
#		{GENERIC_UNIT 2 "Primeval Chariot" 66 47}
		{GENERIC_UNIT 2 "Primeval Chariot" 67 48}
		{GENERIC_UNIT 2 "Primeval Chariot" 67 47}
#ifdef NORMAL
		{GENERIC_UNIT 2 "Primeval Chariot" 68 48}
#endif
#ifdef HARD
		{GENERIC_UNIT 2 "Primeval Chariot" 68 48}
		{GENERIC_UNIT 2 "Primeval Chariot" 69 48}
#endif
# what was this for?
	    [set_variable]
		name=shack
		value=1
	    [/set_variable]
# this also does not work
	    [remove_item]
		x=65,66
		y=33,32
	    [/remove_item]
# try splitting it in two?
	    [remove_item]
		x,y=65,33
	    [/remove_item]
	    [remove_item]
		x,y=66,32
	    [/remove_item]
	    [terrain]
		terrain=Re
		x=65,66
		y=33,32
	    [/terrain]
	    [message]
		speaker=Key Guard
		message= _ "Akka, Dardrus!"
	    [/message]
	    {MOVE_UNIT (id=Key Guard) 66 36}
	    [store_unit]
		[filter]
		    id=Key Guard
		[/filter]
		variable=keyguard
		kill=yes
	    [/store_unit]
	    [message]
		speaker=Dardrus
		message= _ "She wants me to follow her. It is hard to talk in front of everyone."
	    [/message]
	    [message]
		speaker=Caldera
		message= _ "Hah! I've heard this story before! But this is not the time, I would think."
	    [/message]
	    [message]
		speaker=Bresda
		message= _ "Ha ha!"
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "Hrmm. Dardus, make your way to your meeting, but remember where we are."
	    [/message]
	    [message]
		speaker=Dardus
		message= _ "(Humans ...)  Ask yourselves why she is helping us."
	    [/message]
		[objectives]
		side=0
                       [objective]
                        condition=win
                        description=_ "Escape the airship"
                        [/objective]
                       [objective]
                        condition=lose
                        description=_ "Death of Haldrad"
                        [/objective]
                       [objective]
                        condition=lose
                        description=_ "Death of Dardrus"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Bresda"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Tanyche"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Caldera"
                        [/objective]
			note= _ "Move Dardrus to the village Tanyche went to."
		[/objectives]
	[/event]

	[event]
	name=moveto
	    [filter]
		id=Dardrus
		x=66
		y=36
	    [/filter]			
	    [if]
		[variable]
		name=shack
		value=1
		[/variable]
	    [then]
	    [message]
		speaker=Dardrus
		message= _ "$keyguard.name|!"
	    [/message]
	    [store_unit]
		[filter]
		    id=Dardrus
		[/filter]
		variable=dardrus
		kill=yes
	    [/store_unit]
	    [delay]
		time=3450
	    [/delay]
	    [move_unit_fake]
		side=1
		type=$dardrus.type
		x=66,65
		y=36,37
	    [/move_unit_fake]
	    [set_variable]
		name=dardrus.x
		value=65
	    [/set_variable]
	    [set_variable]
		name=dardrus.y
		value=37
	    [/set_variable]
	    [unstore_unit]
		variable=dardrus
		find_vacant=yes
	    [/unstore_unit]
	    [unstore_unit]
		variable=keyguard
	    [/unstore_unit]
	    [message]
		speaker=Bresda
		message= _ "That was quick!"
	    [/message]
	    [message]
		speaker=Caldera
		message= _ "Guffaw! It's like that sometimes."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "Mother!"
	    [/message]
	    [message]
		speaker=Dardrus
		message= _ "Cease your snide comments. $keyguard.name| explained to me how this room works, and I have a translation."
	    [/message]
	    [message]
		speaker=Dardrus
		message= _ "This chamber is a cargo hold, that ring is for teleportation to the ground. We can seal Hera and the thing that used to be Nemesis in here, while we transport down to the ground."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "We have been very lucky. How do we teleport to the ground?"
	    [/message]
	    [message]
		speaker=Dardrus
		message= _ "Someone must stand upon each of the two markers near the wall, while the person to be teleported stands in the circle."
	    [/message]		
	    [message]
		speaker=Dardrus
		message= _ "That person will be exchanged with some object on the ground below. Normally, that object would be chosen from the steering room, but we cannot do that, so it will be random. We need to remove whatever it is from the circle before the next person can go."
	    [/message]		
		[objectives]
		side=0
                       [objective]
                        condition=win
                        description=_ "Teleport Heros to ground"
                        [/objective]
                       [objective]
                        condition=lose
                        description=_ "Death of Haldrad"
                        [/objective]
                       [objective]
                        condition=lose
                        description=_ "Death of Dardrus"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Bresda"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Tanyche"
                        [/objective]
                        [objective]
                        condition=lose
                        description=_ "Death of Caldera"
                        [/objective]
			note= _ "Whatever is exchanged for the teleported unit will need to be moved before the next one can go."
		[/objectives]
	    [/then]
	    [/if]
	[/event]

#define TELEXY
64,38
#enddef

#testing coordinates
#43,33
	[event]
	    name=moveto
		[filter]
		side=1,3
		x=63-68
		y=8-17
		[/filter]
		[message]
		speaker=unit
		message= _ "I recognize this place, it's the steering room."
		[/message]
		[message]
		speaker=Caldera
		message= _ "The Sceptre should be down there somewhere."
		[/message]
		{GENERIC_UNIT 2 "Primeval Firewheel" 62 24}
		{GENERIC_UNIT 2 "Primeval Dogface" 67 24}
		{GENERIC_UNIT 2 "Primeval Driver" 59 22}
		{GENERIC_UNIT 4 "Tomb Protector" 66 45}
		{GUARDIAN}
		{GENERIC_UNIT 4 "Tomb Sentinel" 65 45}
		{GUARDIAN}
	[/event]	

#define TRI_ENDGAME
#		[item]
#		x,y=60,19
#		halo=misc/fail-1.png:100,misc/fail-2.png:100,misc/fail-3.png:100,misc/fail-4.png:100,misc/fail-5.png:100
#		[/item]
# VV for some reason, this macro causes shroud!? VV
		{ENGINE_FIRE 60 18}

		{GENERIC_UNIT 2 "Primeval Slow" 59 18}
		{GENERIC_UNIT 2 "Primeval Driver" 59 20}
		[message]	
		x,y=59,18
		message= "Khak!  Egyrika pyrano!"
		[/message]
		{FLASH_RED (
		{QUAKE rumble.ogg}
		)}
		[message]	
		x,y=59,20
		message= _ "(<i>The engines are failing, we are going down...</i>)  Hera!"
		[/message]
	    {COLOR_ADJUST 30 0 0}
		{MOVE_UNIT id=Hera 62 20}
		[message]
		speaker=Hera
		message= _ "The Eye is gone!  I'll try to land the structure before we crash..."
		[/message]
		[scroll_to_unit]
		id=Nemesis
		[/scroll_to_unit]
		[music]
		name="vengeful.ogg"
		append=no
		immediate=yes
		[/music]
		[message]
		speaker=narrator
		message= _ "The Eye is no longer here, we need to leave..."
		image=portraits/transparent/seth.png~GS()~O(0.6)
		[/message]
		[message]
		speaker=narrator
		message= _ "Go, fly from here!  We will find the little thieves and gain the Angry Eye!"
		image=portraits/transparent/echidna.png~GS()~O(0.6)
		[/message]
		[message]
		speaker=Nemesis
		message= _ "..."
		[/message]
		{MOVE_UNIT id=Nemesis 63 21}
		{MODIFY_UNIT id=Nemesis facing nw}
		{MODIFY_UNIT id=Hera facing se}
		[message]
		speaker=narrator
		message= _ "What are you doing!?"
		image=portraits/transparent/echidna.png~GS()~O(0.6)
		[/message]
		[message]
		speaker=Hera
		message= _ "You..."
		[/message]
		[animate_unit]
            	flag=attack
            	[filter]
                x,y=62,20
            	[/filter]
                [primary_attack]
                    range=melee
                [/primary_attack]
            	hits=yes
        	[/animate_unit]
		[message]
		speaker=Hera
		message= _ "You will not triumph over me, your reward is death!"
		[/message]
		[animate_unit]
            	flag=attack
            	[filter]
                x,y=63,21
            	[/filter]
                [primary_attack]
                    range=melee
                [/primary_attack]
            	hits=yes
        	[/animate_unit]
		[animate_unit]
            	flag=attack
            	[filter]
                x,y=62,20
            	[/filter]
                [primary_attack]
                    range=melee
                [/primary_attack]
            	hits=yes
        	[/animate_unit]
		{FLASH_RED (
		{QUAKE rumble.ogg}
		)}
		[message]
		speaker=narrator
		message= _ "Are you insane?  We don't have time for this!"
		image=portraits/transparent/seth.png~GS()~O(0.6)
		[/message]
		[animate_unit]
            	flag=attack
            	[filter]
                x,y=63,21
            	[/filter]
                [primary_attack]
                    range=melee
                [/primary_attack]
            	hits=yes
        	[/animate_unit]
	    {COLOR_ADJUST 67 0 0}
	    {COLOR_ADJUST 100 0 0}
		[message]
		speaker=narrator
		message= _ "Skreee!"
		image=portraits/transparent/echidna.png~GS()~O(0.6)
		[/message]
	    [remove_item]
		x,y=60,18
	    [/remove_item]
	    {COLOR_ADJUST 170 70 60}
	    {COLOR_ADJUST 250 180 120}
	    [kill]
		side=2
	    [/kill]
	    [kill]
		side=4
	    [/kill]
#enddef


	[event]
	    name=moveto
	    first_time_only=no
		[filter]
		side=1,3
		x=50-75
		y=30-50
		[/filter]
		[if]
		    [have_unit]
			side=1,3
			x,y=59,43
		    [/have_unit]
		    [and]
		    [have_unit]
			side=1,3
			x,y=67,39
		    [/have_unit]
		    [/and]
		    [then]
			[remove_item]
			image=scenery/circle-magic.png
			x,y={TELEXY}			
			[/remove_item]
			[remove_item]
			image=scenery/circle-magic-glow.png
			x,y={TELEXY}			
			[/remove_item]
			[item]
			halo=scenery/circle-magic-glow.png
			x,y={TELEXY}
			[/item]
# I don't think this is necessary
# Actually, I think I used this to see if a unit was on the runes without using a lot of filtering
			[set_variable]
			name=tele
			value=1
			[/set_variable]			
		    [/then]
		    [else]
			[remove_item]
			image=scenery/circle-magic-glow.png
			x,y={TELEXY}			
			[/remove_item]
			[remove_item]
			image=scenery/circle-magic.png
			x,y={TELEXY}			
			[/remove_item]
			[item]
			halo=scenery/circle-magic.png
			x,y={TELEXY}
			[/item]
			[set_variable]
			name=tele
			value=0
			[/set_variable]			
		    [/else]
		[/if]
		[if]
		    [have_unit]
			side=1,3
			x,y={TELEXY}
			[not]
			    id=Haldrad
			[/not]
			[not]
			    id=Bresda
			[/not]
		    [/have_unit]
# v 0.1.27 I've justed added this, see if it works - yep, it looks like it does.
		    [and]
			[variable]
			name=tele
			numerical_equals=1
			[/variable]
		    [/and]
		    [then]
		    [message]
			x,y={TELEXY}
			message= _ "Away I go!"
		    [/message]
		    [store_unit]
			[filter]
			x,y={TELEXY}
			[/filter]
			variable=safe
			mode=append
			kill=yes
		    [/store_unit]
		    [set_variable]
			name=tele
			value=0			
		    [/set_variable]
		    [set_variable]
			name=tele_object
			rand=grain-sheaf,box,goblin,box,brazier,barrel,ornate1,goblin,ornate2,straw-bale1,straw-bale2,barrel,barrel,box,ophis,goblin,terror
		    [/set_variable]
			    [switch]
				variable=tele_object
				[case]
				    value=ophis
				    [unit]
					side=4
					type=Ophis
					random_traits=yes
					generate_name=yes
					x,y={TELEXY}
				    [/unit]
				    [message]
					x,y={TELEXY}
					message= _ "Ghahua?"
				    [/message]
				[/case]
				[case]
				    value=goblin
				    [unit]
					side=4
					type=Goblin Impaler
					random_traits=yes
					generate_name=yes
					x,y={TELEXY}
				    [/unit]
				    [message]
					x,y={TELEXY}
					message= _ "(Whaaa?)"
				    [/message]
				[/case]
				[case]
				    value=terror
				    [unit]
					side=4
					type=Orcish Terror
					random_traits=yes
					generate_name=yes
					x,y={TELEXY}
				    [/unit]
				    [message]
					x,y={TELEXY}
					message= _ "What is this?!"
				    [/message]
				[/case]
				[else]
				    [item]
					image=items/$tele_object|.png
					x,y={TELEXY}
				    [/item]
				    [terrain]
				        terrain=Rp^Xo
					x,y={TELEXY}
					layer=overlay
				    [/terrain]
				[/else]
			    [/switch]
		    [/then]
		[/if]
# 1
		[if]
		    [have_unit]
			id=Haldrad
			x,y={TELEXY}
		    [/have_unit]
		    [then]
# 2
		    [if]
			[have_unit]
			side=1,3
			count=5-999
			[/have_unit]
			[then]
			    [message]
				speaker=Haldrad
				message= _ "What kind of leader would I be if I left my supporters behind?"
			    [/message]
			    [message]
				speaker=Dardrus
				message= _ "-(cough)- You understand, I never agreed to sacrifice myself for you.  I want off this ship too."
			    [/message]
			    [message]
				name=Tanyche
				message= _ "Kha - aha!"
			    [/message]
			[/then]
			[else]
# 3
			    [if]
				[have_unit]
				id=Dardus
				    [or]
					id=Key Guard
				    [/or]
				    [or]
					id=Caldera
				    [/or]
				[/have_unit]
				[then]
				[message]
				speaker=Dardus
				message= _ "I'm not sacrificing myself for you..."
				[/message]
				[message]
				speaker=Caldera
				message= _ "You'd leave your own mother behind?"
				[/message]
				[message]
				speaker=Key Guard
				message= _ "Gre tana..."
				[/message]
				[/then]
				[else]
				    [message]
					speaker=Haldrad
					message= _ "Most of us are off the ship, but how can we keep the ring active without someone on the symbols?"
				    [/message]
				    [message]
					x,y=59,43
					message= _ "We can't!  You go, we'll keep the rings active for you, then do our best to make sure the enemy can't follow."
				    [/message]
				    [store_unit]
					[filter]
					x,y={TELEXY}
					[/filter]
					variable=safe
					mode=append
					kill=yes
				    [/store_unit]
				    [set_variable]
					name=tele
					value=0			
				    [/set_variable]
				    [set_variable]
					name=tele_object
					rand=grain-sheaf,box,box,brazier,barrel,ornate1,goblin,ornate2,straw-bale1,straw-bale2,barrel,barrel,box,ophis,goblin,terror
				    [/set_variable]
				    [switch]
					variable=tele_object
					[case]
					    value=ophis
					    [unit]
						side=4
						type=Ophis
						random_traits=yes
						generate_name=yes
						x,y={TELEXY}
					    [/unit]
					[/case]
					[case]
					    value=goblin
					    [unit]
						side=4
						type=Goblin Impaler
						random_traits=yes
						generate_name=yes
						x,y={TELEXY}
					    [/unit]
					[/case]
					[case]
					    value=terror
					    [unit]
						side=4
						type=Orcish Terror
						random_traits=yes
						generate_name=yes
						x,y={TELEXY}
					    [/unit]
					[/case]
					[else]
					    [item]
						image=items/$tele_object|.png
						x,y={TELEXY}
					    [/item]
					    [terrain]
					        terrain=Rp^Xo
						x,y={TELEXY}
						layer=overlay
					    [/terrain]
					[/else]
				    [/switch]
# 4
				    [if]
				        [have_unit]
					id=Bresda
					[/have_unit]
					[else]
					{TRI_ENDGAME}
					[endlevel]
					{CONTINUE}
					[/endlevel]
					[/else]
# 44
				    [/if]
				[/else]
# 33
			    [/if]
			[/else]
# 22
		    [/if]
		    [/then]
# 11
		[/if]
		[if]
		    [have_unit]
			id=Bresda
			x,y={TELEXY}
		    [/have_unit]
		    [then]
		    [if]
			[have_unit]
			side=1,3
			count=5-999
			[/have_unit]
			[then]
			    [message]
				speaker=Bresda
				message= _ "What kind of leader would I be if I left my supporters behind?"
			    [/message]
			[/then]
			[else]
			    [message]
				speaker=Bresda
				message= _ "How will we get everyone off the ship if we need to keep someone posted at the symbols?"
			    [/message]
			    [message]
				x,y=67,39
				message= _ "It can't be done!  You go, we'll keep the rings active for you, then do our best to make sure the enemy can't follow."
			    [/message]
			    [store_unit]
				[filter]
				x,y={TELEXY}
				[/filter]
				variable=safe
				mode=append
				kill=yes
			    [/store_unit]
			    [set_variable]
				name=tele
				value=0			
			    [/set_variable]
			    [set_variable]
				name=tele_object
				rand=grain-sheaf,box,box,brazier,barrel,ornate1,ornate2,goblin,straw-bale1,straw-bale2,barrel,barrel,box,ophis,goblin,terror
			    [/set_variable]
			    [switch]
				variable=tele_object
				[case]
				    value=ophis
				    [unit]
					side=4
					type=Ophis
					random_traits=yes
					generate_name=yes
					x,y={TELEXY}
				    [/unit]
				[/case]
				[case]
				    value=goblin
				    [unit]
					side=4
					type=Goblin Impaler
					random_traits=yes
					generate_name=yes
					x,y={TELEXY}
				    [/unit]
				[/case]
				[case]
				    value=terror
				    [unit]
					side=4
					type=Orcish Terror
					random_traits=yes
					generate_name=yes
					x,y={TELEXY}
				    [/unit]
				[/case]
				[else]
				    [item]
					image=items/$tele_object|.png
					x,y={TELEXY}
				    [/item]
				    [terrain]
				        terrain=Rp^Xo
					x,y={TELEXY}
					layer=overlay
				    [/terrain]
				[/else]
			    [/switch]
			    [if]
			        [have_unit]
				id=Haldrad
				[/have_unit]
				[else]
				{TRI_ENDGAME}
				[endlevel]
				{CONTINUE}
				[/endlevel]
				[/else]
			    [/if]			 
			[/else]
		    [/if]
		    [/then]
		[/if]
	[/event]

	[event]
	name=turn 57
		{GENERIC_UNIT 2 "Primeval Chariot" 67 47}
	[/event]
	[event]
	name=turn 59
		{GENERIC_UNIT 4 "Tomb Protector" 67 47}
		{GENERIC_UNIT 4 "Tomb Stalker" 67 48}
	[/event]
	[event]
	name=turn 60
		{GENERIC_UNIT 2 "Primeval Chariot" 67 47}
	[/event]
	[event]
	name=turn 62
		{GENERIC_UNIT 4 "Tomb Protector" 67 47}
		{GENERIC_UNIT 4 "Tomb Stalker" 67 48}
	[/event]

	[event]
	name=moveto
	first_time_only=no
	    [filter]
		x=63,64,65,65,64,63
		y=38,37,38,39,39,39
		side=1,3
	    [/filter]
	    [store_locations]
		x,y={TELEXY}
#		terrain=Rp^Xo
		variable=junk
	    [/store_locations]
	    [if]
		[variable]
		name=junk[0].terrain
		equals=Rp^Xo
		[/variable]
		[then]		
		[message]
		speaker=unit
		message= _ "Let's remove this junk..."
		[/message]
		[remove_item]
		x,y={TELEXY}
		[/remove_item]
		[item]
		halo=scenery/circle-magic.png
		x,y={TELEXY}
		[/item]
		[terrain]
		terrain=Rp
		x,y={TELEXY}
		[/terrain]
		[/then]
	    [/if]
	[/event]

#undef TELEXY

	[event]
	name=moveto
	    [filter]
		side=1,3
		x,y=61,21
		[not]
		id=Caldera
		[/not]
	    [/filter]
		[message]
		speaker=unit
		message= _ "There are some cables for connecting the Sceptre to a device, it should be the Queen who decides what to do..."
		[/message]
	[/event]

	[event]
	name=moveto
	    [filter]
		x,y=61,21
		id=Caldera
	    [/filter]
		[message]
		speaker=unit
		message= _ "The Sceptre is connected to machinery by wires. Maybe they are using power from the gem? Well, I can't leave it here."
		[/message]
		[remove_item]
		x,y=61,21
		[/remove_item]
		{TRANSFORM_UNIT (id=Caldera) "Battle Queen"}
		{FLASH_RED ()}
		{QUAKE rumble.ogg}
		[music]
#		name=casualties_of_war.ogg
		name=gathering_storm.ogg
		immediate=yes
		append=no
		[/music]
		{MOVE_UNIT (id=Nemesis) 65 14}
		[message]
		speaker=Nemesis
		message= _ "<i>Grrrah!!</i>"
		[/message]
		[message]
		speaker=Dardrus
		message= _ "That Sceptre is a valuable power source, so I'd imagine that thing is coming after it. I'd also imagine the ship was using the power of the Angry Eye, so the airship has become unstable."
		[/message]				
		[message]
		speaker=Haldrad
		message= _ "Then let us get out of here!"
		[/message]				
		{MOVE_UNIT (id=Hera) 66 7}
		[message]
		speaker=Hera
		message= _ "The vermin make such a mess, they'd better not touch the Eye..."
		[/message]				
	[/event]
		
	[event]
#	name=turn 3
	name=new turn
	first_time_only=no
	    [if]
		[variable]
		    name=tunnel
		    numerical_equals=1
		[/variable]
		[then]
		    [set_variable]
			name=nemesis.x
			value=29
		    [/set_variable]
		    [set_variable]
			name=nemesis.y
			value=24
		    [/set_variable]
		    [set_variable]
			name=hera.x
			value=28
		    [/set_variable]
		    [set_variable]
			name=hera.y
			value=26
		    [/set_variable]
# so that Hera doesn't run off to the keep in the southwest
#		    [set_variable]
#			name=hera.canrecruit
#			value=no
#		    [/set_variable]
# actually, if the shroud would work, this wouldn't be a problem.
		    [unstore_unit]
			variable=nemesis
		    [/unstore_unit]
		    [unstore_unit]
			variable=hera
		    [/unstore_unit]
		    {MOVE_UNIT (id=Nemesis) 38 15}
		    [message]
			speaker=Nemesis
			message=_  "<i>Grrrr!</i>"
		    [/message]
		    {MOVE_UNIT (id=Hera) 37 17}
		    [message]
			speaker=Hera
			message=_  "Grethke klos!"
		    [/message]
		    [message]
			speaker=Haldrad
			message= _ "They've come back this way, we should not hang around."
		    [/message]
		    [message]
			speaker=Bresda
			message= _ "I feel sorry for any of our people still outside the tunnel..."
		    [/message]
# This does not work...  It worked for event = turn 3, maybe because side3 was not present?  Split into two blocks.
		    [place_shroud]
			side=1
			x=1-48,49
			y=1-50,12-50
		    [/place_shroud]
		    [place_shroud]
			side=3
			x=1-48,49
			y=1-50,12-50
		    [/place_shroud]
		[capture_village]
		side=2
		x,y=1-50,1-50
		[/capture_village]
		    [kill]
			side=1,3
		        x=1-48
		    [/kill]
		{GENERIC_UNIT 4 "Tomb Stalker" 52 2}
		{GENERIC_UNIT 4 "Tomb Master" 52 3}
		{GENERIC_UNIT 4 "Tomb Wing" 52 4}
		{GENERIC_UNIT 4 "Tomb Archer" 53 5}
		{GENERIC_UNIT 4 "Tomb Wing" 55 3}
		{GENERIC_UNIT 4 "Tomb HighArcher" 55 4}
		{GENERIC_UNIT 2 "Primeval Swiftfoot" 37 22}
		{GENERIC_UNIT 2 "Primeval Slasher" 36 17}
		{GENERIC_UNIT 2 "Primeval Driver" 34 18}
		{GENERIC_UNIT 2 "Primeval Dogface" 40 19}
		{GENERIC_UNIT 2 "Primeval Warrior" 40 20}
		{GENERIC_UNIT 2 "Primeval Striker" 33 15}
		    [set_variable]
			name=tunnel
			value=200
		    [/set_variable]
		[/then]
		[else]
		    [set_variable]
			name=tunnel
			add=-1
		    [/set_variable]
		[/else]
	    [/if]
	[/event]

	[event]
	name=moveto
	    [filter]
		side=1,3
		x,y=15-20,1-20
	    [/filter]
	{GENERIC_UNIT 4 "Tomb Stalker" 18 12}
	{GENERIC_UNIT 4 "Tomb Master" 20 12}
	{GENERIC_UNIT 2 "Primeval Swiftfoot" 19 13}
	[remove_shroud]
	side=1,3
	x,y=15-20,11-20
	[/remove_shroud]	
		[scroll_to]
		x,y=19,19
		[/scroll_to]
	[delay]
	time=300
	[/delay]
	    [message]
		speaker=unit
		message= _ "We've seen those before..."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "It seems the assault is not Nemesis, come to save us."
	    [/message]
	    [message]
		speaker=Key Guard
		message=_  "Nyx, akka! Akka!"
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "I wish I knew what that meant."
	    [/message]
	    [message]
		speaker=Bresda
		message= _ "I think it means she wants us to not proceed north."
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "Right, then we should not go up there."
	    [/message]
	[/event]    	

	[event]
	name=moveto
	    [filter]
		side=1,3
		x,y=12-25,1-14
	    [/filter]
	{GENERIC_UNIT 4 "Tomb Stalker" 17 8}
	{GENERIC_UNIT 4 "Tomb Master" 15 9}
	{GENERIC_UNIT 4 "Tomb Master" 25 8}
	[set_variable]
	    name=nemesis.x
	    value=13
	[/set_variable]
	[set_variable]
	    name=nemesis.y
	    value=7
	[/set_variable]
	[unstore_unit]
	variable=nemesis
	[/unstore_unit]
	[remove_shroud]
	side=1,3
	x,y=12-24,4-12
	[/remove_shroud]	
	    [message]
		speaker=unit
		message= _ "There's more trouble ahead."
	    [/message]
	    [message]
		speaker=Bresda
		message= _ "That's not Nemesis, is it?"
	    [/message]
	    [scroll_to]
		x,y=13,7
	    [/scroll_to]
	[music]
	name="vengeful.ogg"
	append=no
	immediate=yes
	[/music]
	    [delay]
		time=450
	    [/delay]
	    [message]
		speaker=Nemesis
		message= _ "<i>Snarl!</i>"
	    [/message]
	    [message]
		speaker=Haldrad
		message=_  "She <i>has</i> changed."
	    [/message]
	    [message]
		speaker=Bresda
		message= _ "This was a mistake..."
	    [/message]
	[endlevel]
	    result=defeat
	    music=vengeful.ogg
	[/endlevel]
	[/event]    	

	[event]
	name=moveto
	    [filter]
		side=1,3
		x,y=17-24,25-31
	    [/filter]
	{GENERIC_UNIT 2 "Primeval Slow" 26 21}
	{GENERIC_UNIT 2 "Primeval Dogface" 28 22}
	{GENERIC_UNIT 2 "Primeval Swiftfoot" 32 22}
	{GENERIC_UNIT 2 "Primeval Ironwheel" 33 24}
	{GENERIC_UNIT 2 "Primeval Slasher" 33 28}
	{GENERIC_UNIT 2 "Primeval Striker" 35 24}
	{QUAKE rumble.ogg}
	    [message]
		speaker=Bresda
		message= _ "That sounded like it came from north of here."
	    [/message]
	    [message]
		speaker=Key Guard
		message=_  "Sha! Ana, akka!"
	    [/message]
	    [message]
		speaker=Haldrad
		message= _ "She points on down the tunnel... I guess we keep on, I really have no idea where we are going..."
	    [/message]
	[/event]    	

	[event]
	name=moveto
	    [filter]
		side=1,3
		x,y=25-40,17-23
	    [/filter]
	{GENERIC_UNIT 2 "Primeval Slow" 42 17}
	{GENERIC_UNIT 2 "Primeval Dogface" 41 17}
	{GENERIC_UNIT 2 "Primeval Swiftfoot" 43 18}
	{GENERIC_UNIT 2 "Primeval Ironwheel" 41 19}
	{GENERIC_UNIT 2 "Primeval Slasher" 36 15}
	{GENERIC_UNIT 2 "Primeval Striker" 36 17}
	{GENERIC_UNIT 2 "Primeval Firewheel" 37 12}
	{GENERIC_UNIT 2 "Primeval Slasher" 40 12}
	[unstore_unit]
	    variable=hera
	[/unstore_unit]
	[remove_shroud]
	    x=35-43
	    y=14-20
	[/remove_shroud]
	    [message]
		speaker=Hera
		message= _ "I don't know how you escaped, but I will not make the same mistake twice! Kill them!"
	    [/message]
	[move_unit_fake]
	    side=2
	    type="Primeval Warrior"
	    x=17,20,29,37
	    y=17,27,26,21
	[/move_unit_fake]
	{GENERIC_UNIT 2 "Primeval Warrior" 37 21}
	    [message]
		x,y=37,21
		message=_  "Tek na, Hera... Neanat orum Nemesis, tek na..."
	    [/message]
	    [message]
		speaker=Hera
		message= _ "Very well, I must take care of Nemesis, but my forces will dispatch you."
	    [/message]
	[store_unit]
	    [filter]
		id=Hera
	    [/filter]
		variable=hera
		kill=yes
	[/store_unit]
	[move_unit_fake]
	    side=2
	    type=Primeval Hera
	    x=$hera.x,27,18
	    y=$hera.y,27,14
	[/move_unit_fake]
	    [message]
		x,y=37,21
		message=  "Deta ne ta, zebel!"
	    [/message]
	    [message]
		speaker=Key Guard
		message=  "Shek ta!"
	    [/message]
	    [message]
		speaker=Dardrus
		message= _ "Such language..."
	    [/message]
	[/event]    	


	
       [event]
        name=last breath
            [filter]
                id=Haldrad
            [/filter]
                [message]
                speaker=Haldrad
                message= _ "Oh, what a world..."
                [/message]
                [endlevel]
                result=defeat
                [/endlevel]
        [/event]

       [event]
        name=last breath
            [filter]
                id=Caldera
            [/filter]
                [message]
                speaker=Haldrad
                message= _ "Mother, no!"
                [/message]
                [endlevel]
                result=defeat
                [/endlevel]
        [/event]

        [event]
        name=last breath
            [filter]
                id=Dardrus
            [/filter]
                [message]
                speaker=Dardrus
                message= _ "Oh, what a world..."
                [/message]
                [endlevel]
                result=defeat
                [/endlevel]
        [/event]

        [event]
        name=last breath
            [filter]
                id=Key Guard
            [/filter]
                [message]
                speaker=Key Guard
                message= _ "Noxa..."
                [/message]
                [endlevel]
                result=defeat
                [/endlevel]
        [/event]

        [event]
        name=last breath
            [filter]
                id=Bresda
            [/filter]
                [message]
                speaker=Bresda
                message= _ "Oh, what a world..."
                [/message]
                [endlevel]
                result=defeat
                [/endlevel]
        [/event]

        [event]
        name=time over
	{QUAKE rumble.ogg}
                [message]
                speaker=Bresda
                message= _ "This is a strange feeling..."
                [/message]
                [message]
                speaker=Haldrad
                message= _ "I think the airship is falling! The attackers must have found a way to bring it down..."
                [/message]
		[kill]
		    side=1,3
		[/kill]
		{FADE_TO_BLACK}
                [endlevel]
                result=defeat
                [/endlevel]
        [/event]
# #endif
[/scenario]
